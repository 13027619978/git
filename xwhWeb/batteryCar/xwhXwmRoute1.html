<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="css/reset.css?v=10">
		<link rel="stylesheet" href="css/xwmRoute.css">
		<title></title>
	</head>
	<body>
		<div class="hoverView">
			
		</div>
		<div class="container">
			<div class="fullScreen">
				<div class="topView">
					<div class="weatherView">
						<!-- <p class="weatherTxt"></p> -->
						<img src="img/logo.png" >
					</div>
					<div class="titleView">
						<p>当前站点-</p>
					</div>
					<div class="timeView">
						<p class="dateTxt"></p>
						<p style="margin: 0 10px;">|</p>
						<p class="weatherTxt"></p>
					</div>
				</div>
				<div class="content">
					<div class="content-left">
						<div class="ticketView">
							<div class="ticktTitleView">
								<p class="ticketTitle">观光小火车</p>
								<img src="img/hc-icon.png" >
							</div>
							<div class="descView">
								<p>持一卡通实体卡购票的游客请联系客服：025-83615961</p>
								<p>1. 玄武门为始发站及终点站, 必须下车</p>
								<p>2. 车辆整点,半点发车</p>
								<p>3. 每站10元/站/人，全程优惠票价50元/人</p>
								<p>4. 身高1.1米以下儿童可免费乘坐观光车（不占座），身高1.1米及以上需购票乘车。</p>
								<p>5. 出于对安全乘车考虑，每位成人只可携带1名身高1.1米以下儿童免费乘车。</p>
								<p>6. 运营时间：<font class="yyhctime"></font></p>
								<p>服务电话：025-83615961</p>
							</div>
							<div class="priceView">
								<p>票价<font>1</font><font>0</font>元/站/人</p>
								<a href="javascript:;"></a>
 							</div>
						</div>
						<div class="lineView">
							<div class="ticktTitleView">
								<p class="ticketTitle">观光小火车</p>
								<img src="img/hc-icon.png" >
								<p>单向行驶</p>
							</div>
							<div class="lineContent">
								<div class="line">
									<img class="jt" src="img/jtLeft-icon.png" >
									<img class="jt" src="img/jtLeft-icon.png" >
									<img class="jt" src="img/jtTop-icon.png" >
									<img class="jt" src="img/jt-icon.png" >
									<img class="jt" src="img/jt-icon.png" >
									<img class="jt" src="img/jtBottom-icon.png" >
									
									<div class="lineList xhcList">
										<div class="lineItem">
											<p>玄武门</p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>解放门</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>太平门</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>十里长堤</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>长岸听风</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>翠洲门</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>南京站（南）</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>和平门</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>和平门湿地</p>
											<p class="buyBtn">点击购票</p>
										</div>
										<div class="lineItem">
											<p>后湖印月</p>
											<p class="buyBtn">点击购票</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="content-center">
						<div class="centerContent">
							<div class="salesList">
								
							</div>
							<div class="mapView">
								<div class="mapImg">
									<img src="img/xwmMapImg.png" >
								</div>
							</div>
						</div>
					</div>
					<div class="content-right">
						<div class="ticketView">
							<div class="ticktTitleView">
								<p class="ticketTitle">观光电瓶车</p>
								<img src="img/ggc-icon.png" >
							</div>
							<div class="descView">
								<p>1. 身高1.1米以下儿童可免费乘坐观光车（不占座），身高1.1米及以上需购票乘车。</p>
								<p>2. 车辆整点,半点发车, 间隔15分钟左右</p>
								<p>3. 出于对安全乘车考虑，每位成人只可携带1名身高1.1米以下儿童免费乘车。</p>
								<p>4. 本线路为一站式游览优惠线路，中途不下车。</p>
								<p>5. 运营时间：<font class="yytime"></font></p>
								<p>投诉电话：025-83615961</p>
								<p>&nbsp;</p>
							</div>
							<div class="priceView">
								<p>票价<font>3</font><font>0</font>元/人</p>
								<p class="ticketBuy">点击购票</p>
							</div>
						</div>
						<div class="lineView">
							<div class="ticktTitleView">
								<p class="ticketTitle">观光电瓶车</p>
								<img src="img/ggc-icon.png" >
								<p>单向行驶</p>
							</div>
							<div class="lineContent">
								<div class="line">
									<img class="jt" src="img/jt-icon.png" >
									<img class="jt" src="img/jt-icon.png" >
									<img class="jt" src="img/jtBottom-icon.png" >
									<img class="jt" src="img/jtLeft-icon.png" >
									<img class="jt" src="img/jtLeft-icon.png" >
									<img class="jt" src="img/jtTop-icon.png" >
									
									<div class="lineList dpcList">
										<div class="lineItem">
											<p>玄武门</p>
											<p class="buyBtn"></p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>环洲</p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>梁洲</p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>翠洲</p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>樱洲</p>
											<p class="buyBtn"></p>
										</div>
										<div class="lineItem">
											<p>菱洲</p>
											<p class="buyBtn"></p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<p class="bottomTitle">身高1.1米以下儿童可免费乘坐观光车（不占座），身高1.1米及以上需购票乘车。出于对安全乘车的考虑，每名成人只可携带1名身高1.1米以下儿童免费乘车。</p>
				</div>
				
			</div>

			<script src="js/jquery.min.js"></script>
			<script src="js/app.js"></script>
			<script type="text/javascript">
				var scale =  window.innerHeight / ($('.fullScreen').height() + 20);
				$('.fullScreen').css({
					'transform': 'scaleY(.96)'
				})
				// 当前站点
				var siteId = app.getQueryString('siteId');
				siteId = siteId?siteId:'0';
				
				var showSeconds = 0;
				setInterval(function(){
					showSeconds += 1;
					if(showSeconds % 2 == 0){
						$('.line .jt').eq(0).show();
						$('.line .jt').eq(2).show();
						$('.line .jt').eq(4).show();
						$('.line .jt').eq(1).hide();
						$('.line .jt').eq(3).hide();
						$('.line .jt').eq(5).hide();
						$('.line').eq(1).find('.jt').eq(0).show();
						$('.line').eq(1).find('.jt').eq(2).show();
						$('.line').eq(1).find('.jt').eq(4).show();
						$('.line').eq(1).find('.jt').eq(1).hide();
						$('.line').eq(1).find('.jt').eq(3).hide();
						$('.line').eq(1).find('.jt').eq(5).hide();
					}else{
						$('.line .jt').eq(1).show();
						$('.line .jt').eq(3).show();
						$('.line .jt').eq(5).show();
						$('.line .jt').eq(0).hide();
						$('.line .jt').eq(2).hide();
						$('.line .jt').eq(4).hide();
						$('.line').eq(1).find('.jt').eq(1).show();
						$('.line').eq(1).find('.jt').eq(3).show();
						$('.line').eq(1).find('.jt').eq(5).show();
						$('.line').eq(1).find('.jt').eq(0).hide();
						$('.line').eq(1).find('.jt').eq(2).hide();
						$('.line').eq(1).find('.jt').eq(4).hide();
					}
				}, 250)
				
				var siteList = [
					{
						siteName: '玄武门',
						siteId: 1
					},
					{
						siteName: '解放门',
						siteId: 2
					},
					{
						siteName: '太平堤',
						siteId: 3
					},
					{
						siteName: '十里长堤',
						siteId: 4
					},
					{
						siteName: '水岸听风',
						siteId: 5
					},
					{
						siteName: '翠洲门',
						siteId: 6
					},
					{
						siteName: '南京站（南）站',
						siteId: 7
					},
					{
						siteName: '和平门',
						siteId: 8
					},
					{
						siteName: '和平门湿地',
						siteId: 9
					},
					{
						siteName: '后湖印月',
						siteId: 10
					},
				];
				
				if(siteId == '2'){
					siteList = [
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						}
					];
				}else if(siteId == '3'){
					siteList = [
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						}
						
					];
				}else if(siteId == '4'){
					siteList = [
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						}
						
					];
				}else if(siteId == '5'){
					siteList = [
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						}
						
					];
				}else if(siteId == '6'){
					siteList = [
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						}
					];
				}else if(siteId == '7'){
					siteList = [
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						
					];
				}else if(siteId == '8'){
					siteList = [
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						
					];
				}else if(siteId == '9'){
					siteList = [
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						
					];
				}else if(siteId == '10'){
					siteList = [
						{
							siteName: '后湖印月',
							siteId: 10
						},
						{
							siteName: '玄武门',
							siteId: 1
						},
						{
							siteName: '解放门',
							siteId: 2
						},
						{
							siteName: '太平堤',
							siteId: 3
						},
						{
							siteName: '十里长堤',
							siteId: 4
						},
						{
							siteName: '水岸听风',
							siteId: 5
						},
						{
							siteName: '翠洲门',
							siteId: 6
						},
						{
							siteName: '南京站（南）站',
							siteId: 7
						},
						{
							siteName: '和平门',
							siteId: 8
						},
						{
							siteName: '和平门湿地',
							siteId: 9
						},
						
					];
				}
				
				$('.titleView p').text('当前站点——' + siteList[0].siteName);
				
				
				// 获取天气信息
				$.ajax({
				    url:'https://restapi.amap.com/v3/weather/weatherInfo?key=773c4e4c196eb78e21f220e7e14160d2&extensions=all&city=320100',
				    type:"GET",
				    success:function(data){
						$('.weatherTxt').text('今日 ' + data.forecasts[0].casts[0].dayweather  + ' ' + data.forecasts[0].casts[0].nighttemp + '~' + data.forecasts[0].casts[0].daytemp + '℃')
				    }
				});
				
				// 当前显示购票列表
				var currList = [];
				var interSecond = 0;
				// 初始化时间
				setInterval(function(){
					interSecond += 1;
					var year = new Date().getFullYear();
					var month = new Date().getMonth() + 1;
					month = month<10?'0'+month:month;
					var day = new Date().getDate();
					day = day<10?'0'+day:day;
					var hour = new Date().getHours();
					hour = hour<10?'0'+hour:hour;
					var minutes = new Date().getMinutes();
					minutes = minutes<10?'0'+minutes:minutes;
					var seconds = new Date().getSeconds();
					seconds = seconds<10?'0'+seconds:seconds;
					$('.dateTxt').text(year+'/'+month+'/'+day+' '+hour+':'+minutes+':'+seconds);
					var startDate = new Date(new Date().getTime() - (60*1000));
					var startYear = startDate.getFullYear();
					var startMonth = startDate.getMonth() + 1;
					startMonth = startMonth<10?'0'+startMonth:startMonth;
					var startDay = startDate.getDate();
					startDay = startDay<10?'0'+startDay:startDay;
					var startHour = startDate.getHours();
					startHour = startHour<10?'0'+startHour:startHour;
					var startMinutes = startDate.getMinutes();
					startMinutes = startMinutes<10?'0'+startMinutes:startMinutes;
					var startSeconds = startDate.getSeconds();
					startSeconds = startSeconds<10?'0'+startSeconds:startSeconds;
					var startDateString = startYear + '-' + startMonth + '-' + startDay + ' ' + startHour + ':' + startMinutes + ':' + startSeconds;
					var endDateString = year+'-'+month+'-'+day+' '+hour+':'+minutes+':'+seconds
					
					if(interSecond == 1 || interSecond % 60 == 0){
						// 获取运营时间
						app.getAjax('/battery/getOperation?lineTicketId=', {}, function(res){
							console.log(res.data);
							var nowDay = new Date().getDay();
							if(nowDay == 0){
								nowDay = 6;
							}else{
								nowDay -= 1;
							}
							var startDate;
							var endDate;
							res.data.forEach(function(value, key){
								if(value.lineId == '3'){
									var yyTimeList = value.list;
									startDate = yyTimeList[nowDay].startTime;
									endDate = yyTimeList[nowDay].endTime;
									if(yyTimeList[nowDay].state == '0'){
										$('.yytime').text(startDate + '至' + endDate);
									}else{
										$('.yytime').text(yyTimeList[nowDay].tip);
									}
								}
								if(value.ticketName == '小火车单站票'){
									var yyTimeList = value.list;
									startDate = yyTimeList[nowDay].startTime;
									endDate = yyTimeList[nowDay].endTime;
									if(yyTimeList[nowDay].state == '0'){
										$('.yyhctime').text(startDate + '至' + endDate);
									}else{
										$('.yyhctime').text(yyTimeList[nowDay].tip);
									}
								}
							})
						})
					}
					
					if(seconds % 10 == 0 || seconds == 0){
						app.getAjax('/loopDataV/getDeviceBatterySaleInfo?startDate=' + startDateString + '&endDate=' + endDateString,{}, function(res){
							var salesList = res;
							var newList = [];
							salesList.forEach(function(value, key){
								var hasItem = false;
								newList.forEach(function(item, itemKey){
									if(item.createDate == value.createDate && item.siteName == value.siteName && value.ticketName == item.ticketName){
										item.buyQuantity = parseInt(item.buyQuantity) + 1;
										hasItem = true;
									}
								})
								if(!hasItem){
									newList.push(value);
								}
							})
							newList.sort(function(a, b) {
							  return b.createDate < a.createDate ? 1 : -1
							})
							console.log(newList);
							if(currList.length == 0){
								currList = newList;
								newList.forEach(function(value, key){
									$('.salesList').append(
										'<div class="salesItem">' +
											value.createDate.split(' ')[1] + '购买' + value.ticketName +'<p>x'+ value.buyQuantity +'</p>' +
										'</div>'
									);
								})
								$('.salesList').animate({ scrollTop: ($('.salesItem').length - 6) * 45}, 2000);
							}else{
								newList.forEach(function(value, key){
									var hasItem = false;
									currList.forEach(function(item, itemKey){
										if(value.createDate == item.createDate){
											hasItem = true;
										}
									})
									if(!hasItem){
										currList.push(value);
										$('.salesList').append(
											'<div class="salesItem">' +
												value.createDate.split(' ')[1] + '购买' + value.ticketName +'<p>x'+ value.buyQuantity +'</p>' +
											'</div>'
										);
									}
								})
								$('.salesList').animate({ scrollTop: ($('.salesItem').length - 6) * 45}, 2000);
							}
							console.log(currList);
						})
						
					}
				}, 1000);
			</script>
		</div>
	</body>
</html>
