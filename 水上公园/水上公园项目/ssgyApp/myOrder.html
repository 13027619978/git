<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="css/myOrder.css" />
		<title></title>
	</head>
	<body>
		<div class="container">
			<p class="top_title">我的订单</p>

			<ul class="orderList">
				
			</ul>
		</div>
		
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.qrcode.min.js"></script>
		<script src="js/app.js"></script>
		<script type="text/javascript">
			var orderList = [];
			//获取订单列表
			$(function(){
				$.ajax({
					type:"get",
					url:app.root + 'orderApp/getOrderListByType?wxUserId=' + app.getCookie('openid') + '&type=1&page=1&limit=50',
					success: function(res){
						console.log(res);
						var allOrder = res.data;
						allOrder.forEach(function(value, key){
							if(value.payStatus == '1'){
								orderList.push(value);
							}
						})
						getOrderList(orderList);
					}
				});
			})
			
			
			
			//拼接订单列表
			function getOrderList(orderList){
				var htmlStr = '';
				$.each(orderList, function(key, value){
					var order = value;
					htmlStr += '<li onclick="orderClick(this)">' +
									'<a href="javascript:;" class="orderInfo">' +
										'<div class="orderInfo_l">' +
										'<p>水上公园门票</p>' +
										'<p>' + order.createDate + '</p>' +
										'</div><img src="img/under.png"/>' +
									'</a>' +
									'<div class="orderDetail">' +
										'<div class="qrcode"></div>' +
										'<img src="" class="qrcode_img"/>' +
										'<div class="orderDetail_txt">' +
											'<div class="txt_item">' +
												'<p>订单编号：</p>' +
												'<p>' + order.orderCode + '</p>' +
											'</div>' +
											'<div class="txt_item">' +
												'<p>游览日期：</p>' +
												'<p>' + order.endDate + '</p>' +
											'</div>' +
											'<div class="txt_item">' +
												'<p>全票数：</p>' +
												'<p>' + order.number + '</p>' +
											'</div>' +
										'</div>' + 
									'</div>' +
								'</li>'
								
				})
				$('.orderList').append(htmlStr);
				
				//转换二维码
				$('.orderList li').each(function(key, value){
					$('.orderList li').eq(key).find('.qrcode').qrcode(orderList[key].orderCode);
					$('.qrcode_img').eq(key).attr('src', document.getElementsByTagName('canvas')[key].toDataURL("image/png"));
				})
			}
			
			
			function orderClick(that){
				$(that).find('.orderDetail').slideToggle();
				$(that).siblings().find('.orderDetail').slideUp();
			}
		</script>
	</body>
</html>
