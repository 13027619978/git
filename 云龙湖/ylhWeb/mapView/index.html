<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>电动自驾船</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <style>
        html, body {
            height: 100%;
            width: 100%;
			font-family: '微软雅黑';
        }
		img{
			display: block;
			width: 100%;
		}
		.icon{
			width: 70px;
			margin: 0 auto;
		}
		#container{
			width: 100%;
			height: 300px;
		}
        #addOverlayGroup {
            margin-right: 1rem;
        }
		.amap-marker-label{
			border: 0;
			background-color: none;
			background: rgba(0,0,0,0);
		}
		.info{
			position: relative;
			min-width: 0;
			top: 0;
			right: -15px;
			width: 75px;
			z-index: 999;
			text-align: center;
			color: #fff;
			font-weight: bold;
			background: rgba(0, 0, 0, .5);
			padding: 0;
			margin-bottom: 5px;
			
		}
		.info p{
			font-weight: normal;
			line-height: 20px;
		}
		.amap-logo, .amap-copyright{
			display: none !important;
		}
		.btnView img{
			width: 150px;
			margin-bottom: 10px;
		}
		.ykView{
			background-color: #fff;
		}
		.ykView .title{
			color: #333;
			letter-spacing: 3px;
			line-height: 70px;
			font-weight: bold;
			font-size: 40px;
			text-align: center;
		}
		.desc{
			padding: 0 10px 10px;
			margin-bottom: 10px;
		}
		.desc p{
			font-size: 14px;
			color: #333;
			line-height: 30px;
		}
		.searchView{
			padding: 10px 0;
			background-color: #fff;
			display: flex;
			justify-content: center;
			align-items: center;
			z-index: 999;
		}
		.selectView{
			width: 100px;
			height: 35px;
			font-size: 14px;
			color: #333;
			text-align: left;
		}
		.searchBtn{
			display: block;
			width: 100px;
			height: 35px;
			line-height: 35px;
			background-color: #0000FF;
			color: #fff;
			font-size: 14px;
			text-align: center;
			border-radius: 5px;
			text-decoration: none;
			margin-left: 10px;
		}
    </style>
</head>
<body>
	<div class="ykView">
		<div class="desc">
			<p class="title">电动自驾船</p>
			<p style="text-align: center;">云龙湖喊你来游玩啦！</p>
			<p style="text-align: center;">还没有来的小伙伴们，</p>
			<p style="text-align: center;">抓紧了啊！</p>
			<p style="text-align: center;">精彩的游览方式</p>
			<p style="text-align: center;">让你高效率领略云龙湖之美！</p>
			<img src="img/img10.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img11.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img12.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img13.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img14.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img15.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img16.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img17.webp" >
			<img class="icon" src="img/icon.gif" >
			<img src="img/img18.webp" >
			<img class="icon" src="img/icon.gif" >
			<p style="text-align: center;">或是与家人好友乘上游船，</p>
			<p style="text-align: center;">领略湖光山色，</p>
			<p style="text-align: center;">尽情游览一城青山半城湖的美景~</p>
			<p style="font-weight: bold;">收费规则</p>
			<p>四人船：120元/小时 押金：300元</p>
			<p>六人船：140元/小时 押金：300元</p>
			<p style="font-weight: bold;">乘船须知</p>
			<p>1、每船乘坐数量，包括儿童、禁止超员乘坐；禁止在码头以外自行上下船</p>
			<p>2、乘客上船时需穿好救生衣。扫码确认后开始计时，游船1小时起租，半小时累加，游览结束后必须原路返回原租赁码头。超时部分按正价收取。下船后请立即办理退押手续，以免增加租船费用。押金当天有效，过期不退。</p>
			<p>3、须在规定水域内游览，船只严禁过桥。如遇困难，请按提示立即呼叫巡逻救生艇救助，也可拨打船只上所标明的求助电话。</p>
			<p>4、如遇恶劣天气，景区可终止或停止游船游览娱乐。</p>
		</div>
		<p class="title" style="font-size: 16px;line-height: 30px;border-top: 1px solid #ddd;font-weight: bold;">查看码头空闲数量</p>
	</div>
	
<div id="container"></div>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=c1b024a249b04326f11894fd0e35041d"></script>
<script src="js/jquery-2.1.4.min.js"></script>
<script src="layer/layer.js"></script>
<script src="js/app3.js"></script>
<script src="js/gps.js"></script>
<script type="text/javascript">
	var map;
	var scenicName;
	var scenicId;
	$(function(){
		scenicId = app.getQueryString('scenicId');
		if(!scenicId){
			scenicId = '';
		}
		if(scenicId == '14249a7ee96d4d3f95195a799a3709d2'){
		  scenicName = '杏花坞';
		}else if(scenicId == '2a96be8cf7744d9088986920e2f0d6d9'){
		  scenicName = '开元宾馆';
		}else if(scenicId == '47fca49def99492c80a58d8592400589'){
		  scenicName = '老子水居';
		}else if(scenicId == '4c74b97aaf5b4ff594d11841d4ec8de9'){
		  scenicName = '南湖一号';
		}else if(scenicId == '5acd3b7ae10544ec9632b41392c0e695'){
		  scenicName = '解忧桥';
		}else if(scenicId == '7911474d3e1b42e891bd91f6eaf55077'){
		  scenicName = '未定';
		}else if(scenicId == '8ea1d467f3af4d2aa46b09219d6273f6'){
		  scenicName = '断桥';
		}else if(scenicId == 'b3bb924f74ed4e8ebcad576a382e8791'){
		  scenicName = '沉水廊道';
		}else if(scenicId == 'cdabffaf5cb442da8f5ca9ac50f85efc'){
		  scenicName = '水族馆（沙月岛）';
		}else if(scenicId == 'ed28b43724f0477d9755de59b28160dd'){
		  scenicName = '音乐厅';
		}else if(scenicId == 'f769f573bc3e4df5986ec45993e94fbd'){
		  scenicName = '苏公塔';
		}else if(scenicId == 'e258ca79d5ca4e33b177794a6d815ad5'){
		  scenicName = '测试码头';
		}
		var overlayGroups;
		// 创建地图实例
		map = new AMap.Map("container", {
		    zoom: 13,
		    center: [117.153041, 34.235073],
		    resizeEnable: true,
			zoomEnable:true,
			dragEnable: true
		});
		map.setFeatures(['bg','road']);
		initMap(scenicId, map);
		setInterval(function(){
			initMap(scenicId, map);
		}, 60000)
	})
	
	function searchClick(){
		layer.load('1');
		scenicId = $('.selectView').val();
		initMap(scenicId, map);
		var mapCenter = [];
		if(scenicId == ''){
			mapCenter = [117.153041, 34.235073]
		}else if(scenicId == '14249a7ee96d4d3f95195a799a3709d2'){
			mapCenter = [117.173798, 34.239279]
		}else if(scenicId == '2a96be8cf7744d9088986920e2f0d6d9'){
			mapCenter = [117.13593,34.245462]
		}else if(scenicId == '47fca49def99492c80a58d8592400589'){
			mapCenter = [117.159591,34.228974]
		}else if(scenicId == '4c74b97aaf5b4ff594d11841d4ec8de9'){
			mapCenter = [117.161119,34.223773]
		}else if(scenicId == '5acd3b7ae10544ec9632b41392c0e695'){
			mapCenter = [117.161626,34.226212]
		}else if(scenicId == '8ea1d467f3af4d2aa46b09219d6273f6'){
			mapCenter = [117.153978,34.240263]
		}else if(scenicId == 'b3bb924f74ed4e8ebcad576a382e8791'){
			mapCenter = [117.152994,34.224228]
		}else if(scenicId == 'cdabffaf5cb442da8f5ca9ac50f85efc'){
			mapCenter = [117.15504,34.238198]
		}else if(scenicId == 'ed28b43724f0477d9755de59b28160dd'){
			mapCenter = [117.163347,34.245386]
		}else if(scenicId == 'f769f573bc3e4df5986ec45993e94fbd'){
			mapCenter = [117.167573,34.23185]
		}
		map.setCenter(mapCenter)
	}
	
	function initMap(scenicId, map){
		app.getAjax('deviceDataView/getDeviceShipLease', {},function(res){
			var markers = [];
			var mtList = res;
			mtList.forEach(function(value, key){
				var icon = new AMap.Icon({
				    size: new AMap.Size(15, 45),    // 图标尺寸
				    image: './img/zd.png',  // Icon的图像
				    imageOffset: new AMap.Pixel(0, 25),  // 图像相对展示区域的偏移量，适于雪碧图等
				    imageSize: new AMap.Size(15, 15)   // 根据所设置的大小拉伸或压缩图片
				});
				var currName = value.scenicName;
				var noLease = value.total - value.leaseTotal;
				// 创建点实例
				if(value.scenicName == '杏花坞'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.173798, 34.239279),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-10, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '开元宾馆'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.13593,34.245462),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-110, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '老子水居'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.159591,34.228974),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-110, 0),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '南湖一号'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.161119,34.223773),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-63, 40),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '解忧桥'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.161626,34.226212),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-15, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '断桥'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.153978,34.240263),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-110, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '沉水廊道'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.152994,34.224228),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-110, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '水族馆（沙月岛）'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.15504,34.238198),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-10, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '音乐厅'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.163347,34.245386),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-63, -20),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}else if(value.scenicName == '苏公塔'){
					var marker = new AMap.Marker({
					    position: new AMap.LngLat(117.167573,34.23185),
					    icon: icon
					});
					marker.setLabel({
						offset: new AMap.Pixel(-10, 10),  //设置文本标注偏移量
						content: "<div class='info'><p>总数："+ value.total +"<br>空闲："+ noLease +"</p></div>", //设置文本标注内容
						direction: 'right' //设置文本标注方位
					});
					markers.push(marker);
				}
			})
			
			var myInter = setInterval(function(){
				map.clearMap();
				// 创建覆盖物群组，并将 marker 传给 OverlayGroup
				overlayGroups = new AMap.OverlayGroup(markers);
				map.add(overlayGroups);
				layer.closeAll();
				clearInterval(myInter);
			}, 100);
		})
		
	}
    
</script>
</body>
</html>