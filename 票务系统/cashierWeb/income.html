<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/income.css?v=1.0.0" />
		<title>收款查询</title>
	</head>
	<body>
		<div class="container">
			<div class="collectionView">
				<div class="shopName">
					<img src="img/shop_icon.png"/>
					<p class="payTitle"></p>
				</div>
				<div class="money-view">
					<div class="money-txt">
						<div class="date">
							<div class="dateItem">
								<p>起始时间</p>
								<input class="startDate" type="text" readonly="readonly">
							</div>
							<div class="dateItem">
								<p>结束时间</p>
								<input class="endDate" type="text" readonly="readonly">
							</div>
						</div>
						<div class="money-num">汇总：<p>0.00</p>元</div>
					</div>
				</div>
				<div class="control-view">
					<a href="javascript:;" onclick="uploadClick()">查询</a>
				</div>
				<div class="detailView">
					<p class="detailTile">收款明细</p>
					<div class="detailList">
						<!-- <div class="detailItem">
							<p>支付金额：</p>
							<p>支付时间：</p>
							<p>支付状态：</p>
						</div> -->
					</div>
				</div>
			</div>
		</div>
		
		<script src="js/jquery.min.js"></script>
		<script src="js/app.js"></script>
		<script src="layer/layer.js"></script>
		<script src="js/laydate.js"></script>
		<script type="text/javascript">
			var myInter;
			$(function(){
				layer.load('1');
				laydate.render({
				　　elem : '.startDate',
					value: new Date(),
				　　done: function(value,date, endDate) {
				　　　　
				　　}
				});
				
				laydate.render({
				　　elem : '.endDate',
					value: new Date(),
				　　done: function(value,date, endDate) {
				　　　　
				　　}
				});
				
				myInter = setInterval(function(){
					let startDate = $('.startDate').val();
					let endDate = $('.endDate').val();
					if(startDate && endDate){
						clearInterval(myInter);
						getTotalMoney(function(){
							console.log('123');
						});
					}
				}, 1000)
			})
			
			
			
			function uploadClick(){
				layer.load('1');
				$('.control-view a').text('查询中...');
				getTotalMoney(function(){
					$('.control-view a').text('查询');
				});
			};
			
			function getTotalMoney(success){
				var itemNum = app.getQueryString('code');
				var ticketGroupId = app.getQueryString('group_id');
				let startDate = $('.startDate').val();
				let endDate = $('.endDate').val();
				app.getAjax('cashier/item/order/statistical/sum?itemNum=' + itemNum + '&ticketGroupId=' + ticketGroupId + '&createStartTime=' + startDate + ' 00:00:00&createEndTime=' + endDate + ' 23:59:59', {}, function(res){
					$('.payTitle').text(res.data.itemName);
					$('.money-num p').text(res.data.totalIncome);
					app.getAjax('cashier/item/order/statistical/detail?itemNum=' + itemNum + '&ticketGroupId=' + ticketGroupId + '&createStartTime=' + startDate + ' 00:00:00&createEndTime=' + endDate + ' 23:59:59', {}, function(res){
						$('.detailList').html('');
						let detailList = res.data.reverse();
						detailList.forEach(function(value, key){
							let payStatus = value.payStatus;
							if(payStatus == 1){
								payStatus = '支付成功';
							}else if(payStatus == 0){
								payStatus = '未支付';
							}else if(payStatus == 2){
								payStatus = '已退款';
							}
							$('.detailList').append(
								'<div class="detailItem">'+
									'<p>支付金额：<font>'+value.price+'</font></p>'+
									'<p>支付时间：<font>'+value.payTime+'</font></p>'+
									'<p>支付状态：<font>'+payStatus+'</font></p>'+
								'</div>'
							);	
						})
						layer.closeAll();
						success();
					})
				})
			};
			
		</script>
	</body>
</html>
