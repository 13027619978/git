<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/boatTickets.css?v=1.0.2">
		<style type="text/css">
			.timeBtn{
				background-color: #E2E2E2;
				line-height: 30px;
				padding: 0 10px;
				margin: 0 5px;
				border-radius: 5px;
			}
			.timeBtn.active{
				background-color: #40AFFE;
				color: #fff;
			}
			.radioView label{
				font-size: 14px;
			}
			.ticketDesc{
				font-size: 13px;
				color: red;
				padding-left: 25px;
				line-height: 20px;
			}
			.srp p{
				font-size: 14px;
				color: #333;
				line-height: 20px;
				padding: 2px 10px;
				color: red;
			}
		</style>
		<title>皮划艇购票</title>
	</head>
	<body>
		<div class="container">
			<div class="banner">
				<img src="img/canoeBanner.png" >
			</div>
			<div class="buyInfo">
				<div class="orderView">
					<a class="orderBtn" onclick="orderClick()" href="javascript:;">我的订单</a>
				</div>
				<div class="buy_item">
					<div class="radioView">
						<label for="ticketType6"><input id="ticketType6" type="radio" value="7" name="ticketType" onchange="ticketTypeChange()" >水上运动三人票</label>
						<!-- <label for="ticketType5"><input id="ticketType5" type="radio" value="6" name="ticketType" onchange="ticketTypeChange()" >七夕皮划艇套票</label> -->
						<label for="ticketType1"><input id="ticketType1" type="radio" value="1" name="ticketType" onchange="ticketTypeChange()" >单人皮划艇</label>
						<label for="ticketType2"><input id="ticketType2" type="radio" value="2" name="ticketType" onchange="ticketTypeChange()" >双人皮划艇</label>
						<label for="ticketType4"><input id="ticketType4" type="radio" value="4" name="ticketType" onchange="ticketTypeChange()" >桨板票</label>
						<label for="ticketType3"><input id="ticketType3" type="radio" value="5" name="ticketType" onchange="ticketTypeChange()" >皮划艇体验票</label>
					</div>
				</div>
				<div class="srp" style="display: none;">
					<p>1、含双人皮划艇和桨板一次。</p>
					<p>2、此票限当天使用，可三人同时使用，不可单人多次使用。</p>
					<p>3、桨板游玩需有游泳基础，可自备衣服一套。</p>
					<p>4、有限期自购买之日起至2022年8月24日，逾期自动退票。</p>
				</div>
				<div class="buy_item">
					<p class="item_l">票价：</p>
					<p class="singlePrice">0元/小时</p>
				</div>
				<p class="ticketDesc">七夕皮划艇套票，双人使用</br>仅限2022-08-04至2022-08-07使用</br>过期未使用将自动退票</p>
				<div class="buy_item">
					<p class="item_l">票数：</p>
					<div class="number">
						<a href="javascript:;" onclick="sub(this)">-</a>
						<div class="number_txt">
							<input class="num" type="number" value="0" onchange="quantityChange(this)" disabled="true"/>
							张
						</div>
						<a href="javascript:;" onclick="add(this)">+</a>
					</div>
				</div>
				<div class="buy_item timeView" style="align-items: flex-start;display: none;">
					<p class="item_l" style="line-height: 30px;">时间：</p>
					<div style="font-size: 16px;color: #333;line-height: 25px;display: flex;justify-content: flex-start;align-items: center;flex-wrap: wrap;">
						<div class="timeBtn" onclick="selectTime(this)">10:00-11:00</div>
						<div class="timeBtn" onclick="selectTime(this)">14:00-15:00</div>
					</div>
				</div>
				<div class="buy_item">
					<p class="item_l">手机号：</p>
					<input class="phone" type="number" />
				</div>
			</div>
			<div class="descView">
				<p class="title">活动地点：</p>
				<p>阳光码头（太阳宫旁）</p>
			</div>
			<div class="descView">
				<p class="title">注意事项：</p>
				<p>1，自备衣服一套</p>
				<p>2，要有游泳基础</p>
				<p>3，患有心脑血管系统疾病，患有“三高”疾病的人员不适合参与</p>
				<p>4，严禁未穿好救生衣上船，严禁酒后上船</p>
				<p>5，参与人员应全程听从教练员或管理员的指挥</p>
				<p>6，严禁在船，艇上嬉戏打闹，禁止摇摆船，艇，严禁站立</p>
				<p>7，贵重物品自行保管，为免落水，勿将贵重物品带上船，艇，因保管不善造成的后果自行承担</p>
			</div>
			<div class="detailInfo">
				<p style="text-align: center;font-size: 14px;color: #333;line-height: 40px;text-indent: 0;">--图文详情--</p>
				<p>咨询电话：18005142325</p>
				<div class="zxvx" style="display: flex;justify-content: flex-start;align-items: flex-start;">
					<p>咨询微信：</p>
					<img style="width: 75px;" src="img/zxvx.png" >
				</div>
				<p>玄武湖2022水上运动将再次扬帆起航，期间活动不断，精彩纷呈，还有限时优惠活动哦！一起来玄武湖参与水上健身运动吧！</p>
				<p>皮划艇</p>
				<p>皮划艇分皮艇和划艇两个项目。皮艇起源于格陵兰岛上的因纽特人所制作的一种小船，这种船用鲸鱼皮、水獭皮包在骨头架子上，用两端有桨叶的桨划动。划艇则起源于加拿大，因此又称加拿大划艇。</p>
				<img src="img/canoeImg1.jpg" >
				<img src="img/canoeImg2.jpg" >
				<img src="img/canoeImg3.jpg" >
				<img src="img/canoeImg4.jpg" >
				<p>桨  板</p>
				<p>桨板运动，源于美国夏威夷的桨板冲浪，是一种简单易学，老少咸宜的运动，目前已然成为全球发展最快的娱乐时尚水上运动之一。（该项目预计在六月上线）</p>
				<img src="img/canoeImg5.jpg" >
				<img src="img/canoeImg6.jpg" >
				<img src="img/canoeImg7.jpg" >
				<img src="img/canoeImg8.jpg" >
			</div>
			<div class="bottomView">
				<p>总计：<font class="totalPrice">0.00</font>元</p>
				<a href="javascript:;" onclick="buyClick(this)">购票</a>
			</div>
		</div>
		<script src="js/jquery.min.js"></script>
		<script src="layer/layer.js"></script>
		<script src="js/app.js?v=1.0.2"></script>
		<script type="text/javascript">
			let singleTicket = 0;
			let ticketType;
			let timeValue;
			$(function(){
				if(app.getQueryString('openid')){
					app.setCookie('openid', app.getQueryString('openid'));
				}
				
				var ticketType = app.getQueryString('ticketType');
				if(ticketType){
					$('.num').val(1);
				}
				if(ticketType == 5){
					$("#ticketType3").prop("checked",true);
					$('.timeView').show();
				}else if(ticketType == 4){
					$("#ticketType4").prop("checked",true);
				}else if(ticketType == 1){
					$("#ticketType1").prop("checked",true);
				}else if(ticketType == 2){
					$("#ticketType2").prop("checked",true);
				}else if(ticketType == 6){
					$("#ticketType5").prop("checked",true);
				}else if(ticketType == 7){
					$("#ticketType6").prop("checked",true);
					$('.srp').show();
				}
				
				getTotalPrice();
				
				var str = '<div>';
				str += '<p style="font-size:16px;font-weight:bold;text-align:center;">免责声明</p>';
				str += '<p style="font-size:12px;text-indent:2em;">根据玄武湖水上运动基地相关规定，手机、耳机、车钥匙等贵重物品严禁携带上船，本基地对游客携带上述物品的遗失、损坏不承担赔偿责任。</p>';
				str += '<p style="font-size:12px;text-indent:2em;">本人已阅读以上声明，自愿携带。若发生遗失、损坏按以上规则处理，特此声明！</p>';
				str += '</div>'
				layer.open({
					content: str,
					closeBtn: false,
					btn: ['我已阅读']
				})
			})
			
			function ticketTypeChange(){
				$('.num').val('1');
				$('.timeBtn').removeClass('active');
				timeValue = '';
				getTotalPrice();
			}
			
			function orderClick(){
				$("#ticketType1").prop("checked",false);
				$("#ticketType2").prop("checked",false);
				$("#ticketType3").prop("checked",false);
				$("#ticketType4").prop("checked",false);
				$("#ticketType5").prop("checked",false);
				window.location.href = 'chooseOrder.html';
			}
			
			function add(that){
				ticketType = $("input[name='ticketType']:checked").val();
				if(ticketType){
					var ticketsNumber = parseInt($(that).parent().find('input').val());
					if(ticketsNumber > 19){
						layer.alert('单次最多购买20张');
						return;
					}
					ticketsNumber += 1;
					$(that).parent().find('input').val(ticketsNumber);
					getTotalPrice(ticketsNumber);
				}else{
					layer.alert('请先选择购票种类')
				}
			}
			
			function sub(that){
				var ticketsNumber = parseInt($(that).parent().find('input').val());
				if(ticketsNumber > 1){
					ticketsNumber -= 1;
					$(that).parent().find('input').val(ticketsNumber);
				}
				getTotalPrice(ticketsNumber);
			}
			
			function selectTime(that){
				$(that).addClass('active').siblings().removeClass('active');
				timeValue = 1;
			}
			
			function getTotalPrice(){
				ticketType = $("input[name='ticketType']:checked").val();
				$('.timeView').hide();
				$('.ticketDesc').hide();
				// 三人票描述
				$('.srp').hide();
				if(ticketType == '1'){
					singleTicket = 100;
				}else if(ticketType == '2'){
					singleTicket = 180;
				}else if(ticketType == '4'){
					singleTicket = 150;
				}else if(ticketType == '5'){
					singleTicket = 65;
					$('.timeView').show();
				}else if(ticketType == '6'){
					singleTicket = 80;
					$('.ticketDesc').show();
				}else if(ticketType == '7'){
					singleTicket = 150;
					$('.srp').show();
				}
				$('.singlePrice').text(singleTicket + '元/小时');
				if(ticketType == '5'){
					$('.singlePrice').text(singleTicket + '元/人/小时(仅限周二至周日)');
				}
			
				var totalNumber = $('.num').val();
				$('.totalPrice').text(singleTicket*totalNumber);
			}
			
			function buyClick(that){
				var ticketsNumber = $('.num').val();
				var totalMoney = singleTicket*ticketsNumber;
				var openid = app.getCookie('openid');
				var phone = $('.phone').val();
				if(ticketType == 5){
					if(!timeValue){
						layer.alert('请先选择时间');
						return;
					}
				}
				if(phone.length != 11){
					layer.alert('请先输入正确的手机号');
					return;
				}
				if(!ticketType){
					layer.alert('请先选择购票类型');
					return;
				}
				app.postAjax('canoeOrder/web/pay', {
					totalMoney: totalMoney,
					openId: openid,
					ticketId: ticketType,
					phone: phone,
					number: ticketsNumber
				}, function(res){
					$(that).attr('onclick', '');
					var orderId = res.data.canoeOrder.payId;
					if(res.data.res){
						var res_o = JSON.parse(res.data.res);
						WeixinJSBridge.invoke(
							'getBrandWCPayRequest', {
						       "appId":res_o.appId,     //公众号名称，由商户传入
						       "timeStamp":res_o.timeStamp,  //时间戳，自1970年以来的秒数
						       "nonceStr":res_o.nonceStr, //随机串
						       "package":res_o.package,
						       "signType":res_o.signType,//微信签名方式：
						       "paySign":res_o.paySign //微信签名
							},
							function(res){
								if(res.err_msg == "get_brand_wcpay_request:ok" ) {
									$("#ticketType1").prop("checked",false);
									$("#ticketType2").prop("checked",false);
									$("#ticketType3").prop("checked",false);
									$("#ticketType4").prop("checked",false);
									$("#ticketType5").prop("checked",false);
									$(that).attr('onclick', 'buyClick(this)');
									window.location.replace("canoeTicketsDetail.html?orderId=" + orderId);
								}else{
									//取消禁用购买按钮
						      		$(that).attr('onclick', 'buyClick(this)');
								}
							}
						);
					}
				})
			}
		</script>
	</body>
</html>
