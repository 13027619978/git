<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/searchView.css">
		<title></title>
	</head>
	<body>
		<div class="container">
			<div class="searchView">
				<p>查询条件</p>
				<input class="startDate" type="text" readonly="readonly">
				<input class="endDate" type="text" readonly="readonly">
				<a class="searchBtn" href="javascript:;" onclick="searchClick()">查询</a>
			</div>
			<div class="resulView">
				<div class="thView">
					<p>项目</p>
					<p>消费（元）</p>
				</div>
				<div class="tdView">
					<div class="tdItem">
					</div>
				</div>
				<div class="totalView">
					<p class="dark">合计</p>
					<p class="dark rechargeTotal">0</p>
				</div>
			</div>
		</div>
		
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="layer/layer.js"></script>
		<script src="js/laydate.js"></script>
		<script src="js/app.js"></script> 
		<script type="text/javascript">
			let zyxmName = [
				'湖底探险',
				'摇头飞椅',
				'碰碰车',
				'太空历险',
				'海洋欢乐岛',
				'喷球车',
				'转马',
				'精灵王国'
			];
			let lyxmName = [
				'海豹飞机',
				'钓鱼',
				'挖土机',
				'蹦极',
				'滚筒',
				'飞车',
				'水弹枪',
				'碰碰船',
				'捕鱼儿童票',
				'捕鱼成人票'
			];
			$(function(){
				var nowDate = new Date();
				var nowYear = nowDate.getFullYear();
				var nowMonth = nowDate.getMonth() + 1;
				nowMonth = nowMonth>9?nowMonth:'0'+nowMonth;
				var nowDay = nowDate.getDate();
				nowDay = nowDay>9?nowDay:'0'+nowDay;
				var currDate = nowYear + '-' + nowMonth + '-' + nowDay;
				laydate.render({
					elem: '.startDate',
					value: currDate + ' 00:00:00',
					type: 'datetime'
				});
				laydate.render({
					elem: '.endDate',
					value: currDate + ' 23:59:59',
					type: 'datetime'
				});
				searchClick();
			})
			
			function searchClick(){
				$('.tdView').html('');
				app.getAjax('/api/datav/item/consume/v2', {
					beginCreateTime: $('.startDate').val(),
					endCreateTime: $('.endDate').val()
				}, function(res){
					let rechargeInfo = [];
					res.data.forEach(function(value, key){
						if(lyxmName.indexOf(value.itemName) != -1){
							rechargeInfo.push(value);
						}
						
					})
					let rechargeTotal = 0;
					rechargeInfo.forEach(function(value, key){
						let totalMoney = value.totalIncome*1 - value.totalRefund*1;
						rechargeTotal += totalMoney;
						$('.tdView').append(
							'<div class="tdItem">' +
								'<p>'+ value.itemName +'</p>' +
								'<p>'+ totalMoney +'</p>' +
							'</div>'
						)
					})
					$('.rechargeTotal').text(rechargeTotal);
				})
			}
		</script>
	</body>
</html>
