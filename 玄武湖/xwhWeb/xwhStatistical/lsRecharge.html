<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/searchView.css">
		<title></title>
	</head>
	<body>
		<div class="container">
			<div class="searchView">
				<p>查询条件</p>
				<input class="startDate" type="text" readonly="readonly">
				<input class="endDate" type="text" readonly="readonly">
				<a class="searchBtn" href="javascript:;" onclick="searchClick()">查询</a>
			</div>
			<div class="resulView">
				<div class="thView">
					<p>充值设备</p>
					<p>500（微信）</p>
					<p>500（现金）</p>
					<p>1000（微信）</p>
					<p>1000（现金）</p>
					<p>合计（元）</p>
				</div>
				<div class="tdView">
					<div class="tdItem">
					</div>
				</div>
				<div class="totalView">
					<p class="dark">合计</p>
					<p class="dark rechargeOne">0</p>
					<p class="dark rechargeTwo">0</p>
					<p class="dark rechargeThree">0</p>
					<p class="dark rechargeFour">0</p>
					<p class="dark rechargeTotal">0</p>
				</div>
			</div>
		</div>
		
		<script src="js/jquery-2.1.4.min.js"></script>
		<script src="layer/layer.js"></script>
		<script src="js/laydate.js"></script>
		<script src="js/app.js"></script> 
		<script type="text/javascript">
			$(function(){
				var nowDate = new Date();
				var nowYear = nowDate.getFullYear();
				var nowMonth = nowDate.getMonth() + 1;
				nowMonth = nowMonth>9?nowMonth:'0'+nowMonth;
				var nowDay = nowDate.getDate();
				nowDay = nowDay>9?nowDay:'0'+nowDay;
				var currDate = nowYear + '-' + nowMonth + '-' + nowDay;
				laydate.render({
					elem: '.startDate',
					value: currDate + ' 00:00:00',
					type: 'datetime'
				});
				laydate.render({
					elem: '.endDate',
					value: currDate + ' 23:59:59',
					type: 'datetime'
				});
				searchClick();
			})
			
			function searchClick(){
				$('.tdView').html('');
				app.getAjax('/api/datav/device/recharge/v2', {
					beginCreateTime: $('.startDate').val(),
					endCreateTime: $('.endDate').val()
				}, function(res){
					let rechargeInfo;
					res.data.forEach(function(value, key){
						if(value.deptName == '陆上项目'){
							rechargeInfo = value.deviceCollectList;
						}
					})
					let rechargeOneTotal = 0;
					let rechargeTwoTotal = 0;
					let rechargeThreeTotal = 0;
					let rechargeFourTotal = 0;
					let rechargeTotal = 0;
					rechargeInfo.forEach(function(value, key){
						let rechargeName;
						if(value.deviceRemark){
							rechargeName = value.deviceRemark;
							let totalMoney = value.itemCollectList[0].realCashRecharge*1 + value.itemCollectList[1].realCashRecharge*1 + value.itemCollectList[2].realCashRecharge*1 + value.itemCollectList[3].realCashRecharge*1;
							rechargeOneTotal += value.itemCollectList[0].countRecharge*1;
							rechargeTwoTotal += value.itemCollectList[1].countRecharge*1;
							rechargeThreeTotal += value.itemCollectList[2].countRecharge*1;
							rechargeFourTotal += value.itemCollectList[3].countRecharge*1;
							rechargeTotal += value.itemCollectList[0].realCashRecharge;
							rechargeTotal += value.itemCollectList[1].realCashRecharge;
							rechargeTotal += value.itemCollectList[2].realCashRecharge;
							rechargeTotal += value.itemCollectList[3].realCashRecharge;
							$('.tdView').append(
								'<div class="tdItem">' +
									'<p>'+ rechargeName +'</p>' +
									'<p>'+ value.itemCollectList[0].countRecharge +'</p>' +
									'<p>'+ value.itemCollectList[1].countRecharge +'</p>' +
									'<p>'+ value.itemCollectList[2].countRecharge +'</p>' +
									'<p>'+ value.itemCollectList[3].countRecharge +'</p>' +
									'<p class="dark">'+ totalMoney +'</p>' +
								'</div>'
							)
						}
					})
					$('.rechargeOne').text(rechargeOneTotal);
					$('.rechargeTwo').text(rechargeTwoTotal);
					$('.rechargeThree').text(rechargeThreeTotal);
					$('.rechargeFour').text(rechargeFourTotal);
					$('.rechargeTotal').text(rechargeTotal);
				})
			}
		</script>
	</body>
</html>
